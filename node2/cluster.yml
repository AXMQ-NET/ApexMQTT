# ApexMQTT 集群配置文件
# 
# 集群使用两组端口：
#   1. Gossip 端口 (默认 7946): 基于 hashicorp/memberlist (SWIM 协议)
#      - UDP: 节点发现、心跳检测、状态广播（高频、小数据包）
#      - TCP: 全量同步、可靠传输（低频、大数据包）
#   2. Forward 端口 (默认 7800): 纯 TCP 长连接
#      - 用于 PUBLISH 消息跨节点转发
#      - 用于 Session 迁移数据传输
#      - 用于 Retained 消息同步
#
# 防火墙需开放：
#   - 7946/tcp + 7946/udp (Gossip)
#   - 7800/tcp (消息转发)

# 是否启用集群模式
enabled: true

node:
  # 节点名称，集群内唯一标识
  name: node-2
  
  # 节点地址（内网 IP，用于 Gossip 和消息转发）
  addr: 172.20.184.184
  
  # Gossip 端口 (UDP + TCP，用于节点发现和心跳)
  gossip_port: 7946
  
  # 消息转发端口 (纯 TCP，用于跨节点消息转发)
  forward_port: 7800
  
  # 集群加入密钥（可选，用于节点身份验证）
  # 配置后启用 AES-256 加密，只有密钥相同的节点才能加入集群
  # 所有节点必须配置相同的密钥，否则无法组成集群
  secret_key: "axmq-2026"
  
  # 以下为可选配置，仅在 NAT/容器环境需要时配置
  # advertise_addr: ""    # 对外广播地址（默认使用 addr）
  # advertise_port: 0     # 对外广播端口（默认使用 gossip_port）

# 种子节点列表 (Gossip 地址)
# 新节点通过种子节点加入集群，至少配置一个已运行的节点
# 格式: host:gossip_port
seeds:
  - 172.20.184.183:7946
  - 172.20.184.184:7946
  - 172.20.184.185:7946

# 路由配置
routing:
  # 能力声明同步间隔 (兜底机制，主要靠订阅变更时立即触发同步)
  capability_sync: 30s
